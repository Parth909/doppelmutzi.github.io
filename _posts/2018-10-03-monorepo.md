---
layout: post
title: Lerna and Yarn Workspaces as helpful Duo for Establishing Mono-Repos
slug: monorepo-lerna-yarn-workspaces
date: 2018-10-03
categories: JavaScript
medium:
  - monorepo
  - lerna
  - yarn-workspaces
---

**TODO/Klären**

- auf Bolt überhaupt eingehen? Nochmal versuchen, zum Laufen zu bringen
- Turbo? Parcel? Relevant für dieses Thema?
- Part 1 und Part 2 machen? Part 1 ist mehr die Theorie und Part 2 geht auf Lerna und Yarn workspaces im Detail ein
- besserer Titel in etwa: How npm, yarn, parcel, ... add to the mono-repo formula and why lerna and yarn workspaces is a perfect match

Zusammenhänge npm, yarn, yarn workspaces, lerna, bolt
Was ist native, was ist „user land“
Advanced Frontend Workflow Features / Commands

This post is my take on the topic of _Mono-Repo_. After a brief introduction to _Mono-Repo_ and a comparison with _Multi-Repo_, I go into tools to establishing _Mono-Repos_.

I don't want to assess in great detail what repo typ is better in which circumenstance. However, the goal of this article is all about _Monorepos_ and how [lerna](https://lernajs.io/), [npm](https://www.npmjs.com/), and [yarn](https://yarnpkg.com) ([workspaces](https://yarnpkg.com/en/package/workspaces)) can help. It also makes sense to use these tools in combination.

# What is a Mono-Repo? How does it Compare to Multi-Repo?

Tools like lerna and yarn workspaces have been a decisive factor that managing your codebase in a single repo (a.k.a. mono-repo) has gained some traction for about one or two years. A lot of articles were written or conference talks were given about this topic. I don't want to go to deeply into the theory behind mono-repos, however, I would like to describe briefly what mono-repos are and how they compare to multi-repos in a way that we have a similar understanding.

**TODO** Mono-repo vs Multi-repo...

# Tool Landscape for Mono-Repos

- packages are „mini-repos“ that can be versioned, built and published independently.
- managing these dependencies between packages through symlinks:
- Lerna and Yarn Workspaces give us the ability to build libraries and apps in a single repo (a.k.a. monorepo) without forcing us to publish to npm or other registries.
  - The beauty behind Lerna and Yarn Workspaces is that these tools can find package dependencies by analyzing the package.json files under each package.
  - After determining these dependencies, they create symlinks that make each package think that their dependencies have been installed under their own node-modules folder!
- We can go through code-test-debug cycles much faster by sharing components locally.
- Lerna and Yarn Workspaces together improve the developer experience of managing multiple packages in a monorepo.

## Correlation between _npm_, _yarn_, _yarn workspaces_, and _lerna_

I want to shed light on the clutter how _npm_, _yarn_, _yarn workspaces_ and _lerna_ are involved in the topic of mono-repos and how they are correlated.

Take a look at the following &quot;set diagram&quot;.

![Native features](../images/monorepos/native.png)

It depicts three main players and how they correlate. By the way, do not take the proportions too seriously, the diagram's purpose is just to give an impression how things are connected.

_npm_ (marked with 1) and _yarn_ (2) are both native package managers that have many features in common (3). As an example, both leverage the concept of _package.json_ as container for dependency management, which was introduced by _npm_ back in the days. More shared concepts and features are dependency management, publishing, or using lock files to &quot;freeze&quot; dependency versions. There are even more features originated by _npm_ that are also leveraged by _yarn_, such as publishing to npm registry.

One of the reasons for establishing _yarn_ was performance &ndash; it took too long to install dependencies in large projects. Another aspect was missing features, such as a sophisticated concept for freezing versions, offline capabilities, or deterministic behavior in terms of dependency resolution. Though, many of these gaps of _npm_ have vanished over the time and both technologies are more and more feature compliant nowadays.

Things that still belong solely to _npm_ (1) or _yarn_ (2) are _package-lock.json_ files or _yarn.lock_ files, respectively. One big feature that is exclusive to _yarn_ is _yarn workspaces_ (4) that was added to _yarn_ about a year ago. It expands _yarn_ by native mono-repo capabilities. The next section goes more into mono-repo features.

**TODO Beispiele für 1**
**TODO** überlegen, die Grafik abzuändern, so dass (2) viel kleiner ist im Vergleich zu (1) und (3) viel größer dargestellt wird.

## Mono-repo &ndash; What is &quot;native&quot;? What is &quot;user land&quot;?

Consider the next diagram that shows how technologies in the mono-repo environment are connected to each other.

![Mono-repo features](../images/monorepos/mono-repo.png)

Marked in read are those of them that provide mono-repo capabilities. All of them are based either on _npm_ or _yarn_. Latter do not provide advanced features for building mono-repose besides _npm link_ and _yarn link_, respectively.

[yarn workspaces](https://yarnpkg.com/lang/en/docs/workspaces/) is the only representative that exposes mono-repo capabilities natively. [lerna](https://lernajs.io) is around for quite some time even before _yarn workspaces_ has existed. It has the capabilities to provide mono-repo features on the level of user land with _npm_ or _yarn_ as dependency management tool through semantic links. It leverages semantic links for this purpose. _lerna_ also allows for using _yarn workspaces_ and, then, leaves the whole mono-repo aspect solely to the natively implemented features of _yarn workspaces_. Furthermore, _lerna_ provides sophisticated publishing and version management features to even publish projects independently from each other.

[bolt](https://github.com/boltpkg/bolt) is a relatively new project that bases on _yarn workspaces_. Its goal is to add more helpful commands on this foundation.

# Lerna and / or Yarn Workspaces

## Lerna

## Yarn Workspaces

## Advanced Frontend Workflow Features and Commands

# Mono-Repo Tooling &quot;Cheatsheets&quot;

screenshots bzws. codesandbox embedded

# Timing Comparison

npm mittlerweile nicht mehr langsamer

# Conclusion
